# Using PDF Files in the Playground 
Attachments in Braintrust logs enable you to capture files, such as images, PDFs, or other documents, provided by your users. However, you may also want to include these attachments in datasets to test prompts within the Braintrust Playground. This cookbook provides step-by-step instructions for running prompts in the Playground using file attachments in two different ways.

## Attachment Methods

There are two primary ways to include PDF files in the Playground:

- Attach files using the paperclip UI button
- Use Public URLs

## Learning Objectives

After completing this guide, you will be able to:

- Emit spans containing embedded file attachments

- Log system and user prompts into separate spans within the same trace

- Save spans into datasets

- Utilize the “Try Prompt” feature to transfer spans to the Playground

- Rapidly iterate prompts using file attachments in the Playground

We will illustrate these concepts using earnings report transcripts as PDF files.

## Prerequisites

### Setting Up API Keys

Follow these steps to configure your environment:

1. Create a Braintrust account and generate an API key.

2. Create a .env.local file containing your API key:
    ```
    BRAINTRUST_API_KEY=your-api-key
    ```
3. Enter your OpenAI API key in the AI Providers settings page in your Braintrust organization.

### Installing Typescript Dependencies
Install [pnpm](https://pnpm.io/installation) or a package manager of your choice. 

Use the following `package.json`:
```json
{
	"name": "pdf-attachment-demo",
	"version": "1.0.0",
	"description": "PDF Attachment Demo",
	"scripts": {
		"logging": "ts-node simulate_logging.ts"
	},
	"devDependencies": {
		"@types/node": "^22.15.14",
		"@types/dotenv": "^8.2.0",
		"ts-node": "^10.9.2",
		"typescript": "^5.4.2"
	},
	"dependencies": {
		"dotenv": "^16.1.4",
		"braintrust": "^0.0.201",
		"openai": "^4.97.0"
	}
}
```

Install dependencies by running:
```bash
pnpm install
```

## Implementation Guide
### Setting Up Braintrust and OpenAI clients
Use the following configuration for client initialization:
```typescript
import { initLogger, wrapOpenAI, wrapTraced, currentSpan, Attachment } from "braintrust";
import { OpenAI } from "openai";
import dotenv from 'dotenv';
dotenv.config();

// ── Braintrust + OpenAI setup ────────────────────────────────────────────────
const logger = initLogger({
    projectName: "pdf-attachment-demo",
    apiKey: process.env.BRAINTRUST_API_KEY,
});

const client = wrapOpenAI(
    new OpenAI({
        baseURL: "https://braintrustproxy.com/v1",
        apiKey: process.env.BRAINTRUST_API_KEY,
    }),
);
```

### Defining PDF Resources
Set the PDF files and their URLs:
```typescript
// ── PDF list with URLs ────────────────────────────────────────────────
const pdfFiles = [
    { filename: "META-Q4-2024-Earnings-Call-Transcript.pdf", url: "https://s21.q4cdn.com/399680738/files/doc_financials/2024/q4/META-Q4-2024-Earnings-Call-Transcript.pdf" },
    { filename: "Citi-4Q24-Earnings-Transcript.pdf", url: "https://www.citigroup.com/rcs/citigpa/storage/public/Earnings/Q42024/4Q24-Earnings-Transcript.pdf" },
    { filename: "jpmc-4q24-earnings-transcript.pdf", url: "https://www.jpmorganchase.com/content/dam/jpmc/jpmorgan-chase-and-co/investor-relations/documents/quarterly-earnings/2024/4th-quarter/4q24-earnings-transcript.pdf" },
    { filename: "att-4q24-transcript.pdf", url: "https://investors.att.com/~/media/Files/A/ATT-IR-V2/financial-reports/quarterly-earnings/2024/4Q24/t-usq-transcript-2025-01-27.pdf" },
    { filename: "Qualcomm_Q1FY25EC_Transcript_2-5-24.pdf", url: "https://s204.q4cdn.com/645488518/files/doc_events/2025/Feb/05/QCOM_Q1FY25EC_Transcript_2-5-24.pdf" },
    { filename: "host-hotels-4q24-transcript.pdf", url: "https://www.hosthotels.com/-/media/HostHotels/Files/DownloadLinksAssets/Earnings-Call-Transcript/Host_Hotels_Resorts_Inc_Earnings_Call_Transcript.pdf" },
    { filename: "homedepot-4q24-transcript.pdf", url: "https://ir.homedepot.com/~/media/Files/H/HomeDepot-IR/documents/hd-4q24-transcript.pdf" },
];
```

### Defining the System Prompt
Establish the guidelines for the analysis:
```typescript
// ── System prompt for the assistant ─────────────────────────────────────────────
const SYSTEM_PROMPT = `
You are a financial analyst specializing in earnings call analysis. Your task is to provide a quick, bullet-point summary of the key points from earnings call transcripts.

Focus ONLY on these 3-5 key points:
• Revenue and EPS figures vs expectations
• Major business highlights or challenges
• Forward guidance for next quarter

Keep each point to 1-2 sentences maximum. Be extremely concise and focus only on the most important information.
Only output the key points, no other text.
`;
```

### Processing PDFs
Implement a function to handle PDF processing:
```typescript
// ── Helper function to process a single PDF ────────────────────────────────
const processPdf = wrapTraced(async (pdfFile: { filename: string; url: string }) => {
    console.log(`Processing ${pdfFile.filename}...`);

    // Fetch and encode the PDF file from URL (with error handling)
    let pdfData: Buffer;
    let base64String: string;
    try {
        const response = await fetch(pdfFile.url);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status} ${response.statusText}`);
        }
        const arrayBuffer = await response.arrayBuffer();
        pdfData = Buffer.from(arrayBuffer);
        base64String = pdfData.toString('base64');
    } catch (err: any) {
        console.error(`Failed to download ${pdfFile.url}:`, err);
        return; // Skip this PDF and continue with the next
    }

    const userPrompt = "Please analyze this earnings call transcript";
    const rootSpan = currentSpan();
    rootSpan.setAttributes({ name: pdfFile.filename });
    const rootSpanSlug = currentSpan().export();
    
    // Create chat completion with file data
    const completion = await client.chat.completions.create({
        model: "gpt-4o",
        messages: [
            {
                role: "system",
                content: SYSTEM_PROMPT
            },
            {
                role: "user",
                content: [
                    {
                        type: "file",
                        file: {
                            filename: pdfFile.filename,
                            file_data: `data:application/pdf;base64,${base64String}`
                        }
                    },
                    {
                        type: "text",
                        text: userPrompt
                    }
                ]
            }
        ],
        max_tokens: 500
    });

    const summary = completion.choices[0]?.message?.content;

    // if no summary is generated, log an error and return
    if (!summary) {
        console.warn("No summary generated");
        return;
    }
    // Console log that the summary was created
    console.log(`\nEarnings Summary for ${pdfFile.filename}: Summary Created! View in the Braintrust UI!\n`);

    // log the output of the LLM call to the root span
    rootSpan.log({
        output: summary
    });

    // Log system prompt span
    await logSystemPrompt(pdfFile.filename, pdfFile.url, summary, rootSpanSlug);

    // Log user prompt span
    await logUserPrompt(pdfFile.filename, pdfFile.url, userPrompt, summary, rootSpanSlug, base64String);
    
}, logger);
```

### Logging Spans
Separate functions handle logging system and user spans:
#### System Span Logging:
```typescript
// ── Helper function to log system prompt span ──────────────────────────────
async function logSystemPrompt(filename: string, url: string, summary: string, rootSpan: Promise<string>) {
    const systemSpan = wrapTraced(async () => {
        const span = currentSpan();
        span.setAttributes({ 
            name: "system_prompt", 
            type: "llm", 
            parent: (await rootSpan).toString()
        });
        
        span.log({
            input: [{
                role: "system",
                content: SYSTEM_PROMPT
            }],
            output: summary
        });
    }, logger);
    await systemSpan();
}
```
#### User Span Logging:
```typescript
// ── Helper function to log user prompt span ───────────────────────────
async function logUserPrompt(filename: string, url: string, userPrompt: string, summary: string, rootSpan: Promise<string>, base64String: string) {
    const userPromptSpan = wrapTraced(async () => {
        const span = currentSpan();
        span.setAttributes({ 
            name: "user_prompt", 
            type: "llm", 
            parent: (await rootSpan).toString()
        });
        
        // Reconstruct PDF data from base64
        const pdfData = Buffer.from(base64String, 'base64');

        const attachment = new Attachment({
            data: pdfData,                       
            filename,
            contentType: "application/pdf",
          });
        
        span.log({
            input: [
                { role: "user", content: userPrompt },
            ],
            output: summary,
            metadata: {
                filename,
                url,
                base64String,
                attachment
            }
        });
    }, logger);
    await userPromptSpan();
}
```

### Executing the Main Process
Invoke the main processing function:
```typescript
// ── Main function to process all PDFs ─────────────────────────────────────
const generateSummary = async () => {
    console.log(`Found ${pdfFiles.length} PDFs to process`);

    try {
        for (const pdfFile of pdfFiles) {
            await processPdf(pdfFile);
        }
    } catch (err: any) {
        console.error("Error in main:", err);
        if (err?.response?.data) {
            console.error("Response data:", err.response.data);
        }
    }
};

generateSummary();
```
#### Run your file
This will work if you used the package.json above and named the file "simulate_logging.ts"
```bash
pnpm logging
```
or use this command with your file name
```bash
pnpm ts-node {file_name}
```

## Using the Braintrust UI

### Saving User Prompt Spans to a Dataset
Store the user spans from your PDF traces into a dataset (e.g., "example")

![add span to dataset](./assets/add-span-to-dataset.gif)

You can use the hotkey D (add span to dataset) to speed this up

### Saving System Prompt Span and Opening Playground
Select a system prompt span and click "Try prompt" to:

1. Save the prompt (e.g., "system1") to your Library
2. Launch the Playground using the saved prompt.

![try prompt from span](./assets/try-prompt.gif)

### Testing File Attachment Methods

Before we set up the public URL method, I want to first show you how to manually attach a file using the paperclip icon.

Start by clicking **+ Message** to add a user prompt. Then select **+ Message Part** > **File**.

This will display a paperclip icon on the right side. Click it to upload a file from your local machine.

**Paperclip UI method**: Add file manually by clicking the paperclip icon

![paperclip UI method](./assets/paperclip.gif)

Now that you’re familiar with the manual attachment option, let’s go over how to use the public URL method.

**Public URL method**: Paste the URL directly into the file message part.

![public url method](./assets/url.gif)

## Next Steps
Now that you understand the process of converting spans with PDF attachments into a dataset and executing the PDFs in the playground, you can:

Learn more about [Multimodal prompts in the Playground](https://www.braintrust.dev/docs/guides/playground#multimodal-prompts)

Check out the blog [Logging with Attachments](https://www.braintrust.dev/blog/attachments)

Read about [Brainstore](https://www.braintrust.dev/blog/brainstore), the custom database that is the engine of Braintrust



